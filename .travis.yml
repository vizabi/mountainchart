language: node_js
dist: trusty
sudo: true
node_js:
- 7.5.0
addons:
  apt:
    packages:
    - python-pip
notifications:
  email: false
  slack:
    rooms:
    - gapminder:siB4Z9ymsYR6qHnRPpgUoB2Q#vizabi-spam
    on_success: change
    on_failure: always
cache:
  directories:
  - node_modules
before_install:
- npm install -g npm@latest
- sudo pip install s3cmd
before_script:
- export DISPLAY=:99.0
- sh -e /etc/init.d/xvfb start
- npm run build
script:
- '[ "${TRAVIS_PULL_REQUEST}" = "false" ] && sh deploy.sh || true'
after_success: ".cicd/beta_npm_ver.js"
deploy:
  skip_cleanup: true
  provider: npm
  email: kgrpwnz@gmail.com
  api_key:
    secure: kFEP8RuFHwsG+CQlWg5uErY5CxFQ61utqxRjbpD8UuWOGP9LrAtxBsV8LnJechR6f4BEsyZoeGsp5Je+otjauVTBRCRaCE5ZrkCIVauAR0c8Dt8HHGlV1Tnwj3EuorpcMnYjgYnw/P1CcoeegduTFUapLFmrwzwAsVkuOHHGmKbw5l0bWUwjTiovUtx1bLhTcNvhW8f8RTsxjiDMEoMyEdXQSziTApggN8VM4EIV2JBGld6MFFg1ZqHYAYGNl2jiYqlilN9F60eUNMtb1141+YwVdtwQ/TRWNJlMIihaKF8EZzbBDVRQB7PGfEDjkIjZ0Eb1Ftwl4FUb8XfovaP46lIZvornpVxTvROmr3T1wI4UdKH3ak9wUYcezS/rkCiwZ0hdb6xcTt+Fb3AdywbBfuSLC+nPsf6+JWbaJUqYzgOUVEXoysKyG7g7GTzsei7pYfjxpVzpzylfXYrBLeRo0J5Y94WIvMnS8eLY1evvALMoWhz0EyjDD+6ZtAJQ7nCFz+yHlKFhkBqzjyrfEE/4vmNp6UXIkjNYKqHrBvJlph/B9AyecxqOan0bYTgGGJFQd5ZH2QuFaunqS4dRLA/q/fB2uAK1CXpjPQBGrEPRwr5I5Oa3zPZeimiUHD6YgvHFWhwW+7uukVXJcVMhZ8BpccaOndVifEaCse68YIIqUgU=
  on:
    branch: develop
    node: 7.5.0
    condition: "-e /tmp/deployment.flag"
