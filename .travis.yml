language: node_js
dist: trusty
sudo: true
node_js:
- 7.5.0
addons:
  apt:
    packages:
    - python-pip
notifications:
  email: false
  slack:
    rooms:
    - gapminder:siB4Z9ymsYR6qHnRPpgUoB2Q#vizabi-spam
    on_success: change
    on_failure: always
cache:
  directories:
  - node_modules
before_install:
- npm install -g npm@latest
- sudo pip install s3cmd
before_script:
- export DISPLAY=:99.0
- sh -e /etc/init.d/xvfb start
- npm run build
script:
- npm run deploy
deploy:
  skip_cleanup: true
  provider: npm
  email: kgrpwnz@gmail.com
  api_key:
    secure: 5WIy4u9i46eO4iM0DYJNNsv01ND/Lv33RcnO1dpfurdj/aO0hDVTLk/WfKLQ61FIo8z1Ixl/LH1aKq2vqhxAbh00u8iBG5Oisuh8qd4gaQgp0OUS83PrZuwcLxP3i5xsOcD++AMaYaaxELKIEh7SZY/H0PRDuYlGk6JB8mgJkab1lvhWwzdj8pfZMyjbp0jAprkYV9SXn/jfFm1PyjGo2SjKIPuAaQDaeb5jQQFOFMGBaFf/fQgd+n4rePgEQYfMGuRI+tq+weAro5Wse5kum/3G6TP8T2J2bxhrE4utCYHETZ1RkHqzE3bsR+o9Rc2EFSsQgnRrMeIhVxmSVZhj/s2Hj3Dho9mIYA4nheElsZE1o5L0OPgL8dsL+e4JSPJmsIyj+1er6h7h7qatTaxQfPyTEEEscy93UhsfAZ/pi2rZFYoXy0AQfhwzpw4m3YN4ibZ0UgwBe2NZgU8uf7Nj6GaLAI14AYfus4eU8HIbJIIjOC4U2vniYEjxspiSAlJdCKbZXOB5hO2jWFEfRTxX3YjWNeKkxPVGDVN/056Wf+b99YaHlcLzdt8ggAovG7C7ejA1ck/53ee/isVqZMD/Z49+9TqyElu4jpjOiUJwf17kNwU6NSMByJozItu/BOwmKyjqkxscFtnm1IviOsCqY+UcWAA53/tQApjjAAf0I9Y=
  on:
    branch: develop
    node: 7.5.0
    condition: "-e /tmp/deployment.flag"
